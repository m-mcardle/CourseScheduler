image: python:latest

# Change pip's cache directory to be inside the project directory since we can
# only cache local items.
variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"

test:
  script:
    - cd cli
    - python -m unittest -b tests/*.py
  rules:
    - if: $CI_COMMIT_BRANCH == "main"
      changes:
        - cli/**/*

deploy:
  script:
    - chmod 400 $SSH_KEY
    - scp -i $SSH_KEY -o StrictHostKeyChecking=no -r ./client Team-205@20.168.192.248:~/
    - ssh -i $SSH_KEY -o StrictHostKeyChecking=no Team-205@20.168.192.248 "cd ~/client; forever stopall; npm install; forever start -c 'npm start' ./;"
  rules:
    - if: $CI_COMMIT_BRANCH == "main"
      changes:
        - client/**/*
